
% TODO: centralise refentry guts
\startxmlsetups xml:single-refentry

	\startbodymatter

	\xmlflush{#1}

	% TODO: only if present
%	\startsection[title=Author,reference=sec:TODO]
%		\xmlall{#1}{/refentryinfo/author}
%	\stopsection

	\stopbodymatter

\stopxmlsetups

\startxmlsetups xml:reference

	\startReference[title=\xmltext{#1}{./title}]

	\xmlflush{#1}

	\stopReference

\stopxmlsetups

\startxmlsetups xml:collated-refentry

	% TODO: handle multiple refnames
	\startRefentry[title=\xmltext{#1}{refnamediv/refname}(\xmltext{#1}{refmeta/manvolnum})]

	\xmlflush{#1}

	% TODO: only if present
%	\startsection[title=Author,reference=sec:TODO]
%		\xmlall{#1}{/refentryinfo/author}
%	\stopsection

	\stopRefentry

\stopxmlsetups

\startxmlsetups xml:author
	% XXX: copy the scheme per the html xslt
	\xmlconcat{#1}{firstname|surname}{ }
	{, }
	\xmlall{#1}{affiliation}
\stopxmlsetups

\startxmlsetups xml:firstname
	\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:surname
	\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:affiliation
	\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:orgname
	\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:refname
	\xmlflush{#1}
\stopxmlsetups

\startxmlsetups xml:refnamediv
	\startsection[title=Name,reference=sec:TODO]
	\xmlconcat{#1}{refname}{, }
	\thinspaceâ€”\thinspace
	\xmltext{#1}{refpurpose}
	\stopsection
\stopxmlsetups

\startxmlsetups xml:refsynopsisdiv
	\startsection[title=Synopsis,reference=sec:TODO]
	\xmlflush{#1}
	\stopsection
\stopxmlsetups

\startxmlsetups xml:arg
	\doifelse{\xmlatt{#1}{choice}} {opt}
		{[\thinspace\xmlflush{#1}\thinspace] }
		{\thinspace\xmlflush{#1}\thinspace}
\stopxmlsetups

\startxmlsetups xml:group
	\doifelse{\xmlatt{#1}{choice}} {opt}
		{[\xmlconcat{#1}{arg}{\|}]}
		{\{\xmlconcat{#1}{arg}{\|}\}}
\stopxmlsetups

\startxmlsetups xml:sbr
	\crlf
\stopxmlsetups

% XXX: why isn't width automatically correct here?
\definedescription[synopsis][headstyle=normal,width=1.5em]

\startxmlsetups xml:cmdsynopsis
	\startsynopsis{\xmltext{#1}{command}}
	\xmlall{#1}{/arg|group|sbr}
	\stopsynopsis
\stopxmlsetups

\startxmlsetups xml:refsection
	\startsection[title={\xmltext{#1}{title}},reference=sec:TODO]
	\xmlflush{#1}
	\stopsection
\stopxmlsetups


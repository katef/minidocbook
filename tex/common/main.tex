
% TODO: xinclude: http://wiki.contextgarden.net/Command/xmlinclude

% XXX: \definestartstop left=,right= polyfill until this is committed to ConTeXt proper
\unprotect
\unexpanded\def\syst_startstop_indeed#1%
  {\groupedcommand
     {\def\currentstartstop{#1}%
\startstopparameter\c!commands % better: setups so that will show op soon
      \dostarttagged\t!construct\currentstartstop
      \usestartstopstyleandcolor\c!style\c!color
      \startstopparameter\c!left}
     {\def\currentstartstop{#1}% safeguard, nto really needed
      \startstopparameter\c!right
      \dostoptagged
      \startstopparameter\c!inbetween}}
\protect

\setupinteraction[state=start]
\setupfootnotes[interaction=yes]
\setupcolors[state=start]

\setupblackrules[width=\hsize,height=1pt]

% provide metrics for \setupalign[hanging]
\definefontfeature
	[default][default]
	[protrusion=quality,expansion=quality]
\setupalign[hanging,hz]
\setupalign[hyphenated,lesshyphenation,stretch]

\input otf.tex

\input common/debug.tex
\input common/paper.tex
\input common/canon.tex
\input common/fallback.tex
\input common/primitive.tex

\definemarking[doc:company]  % Bubblephone Ltd.
\definemarking[doc:title]    % SID Users' Guide
\definemarking[doc:revision] % 4
\definemarking[doc:product]  % MCT
\definemarking[doc:author]   % Katherine Flavel
\definemarking[doc:classify] % Unrestricted
\definemarking[doc:keywords] % tea, fish, bricks % XXX: really comma separated?
\definemarking[doc:date]     % TODO what format?
% TODO: releaseinfo WIP

% input DTD
\startmode[minidocbook]
	\input minidocbook/structural
	\input minidocbook/primitive
	\input minidocbook/blocks
	\input minidocbook/inline
	\input minidocbook/lists
	\input minidocbook/links
	\input minidocbook/refentry
	\input xhtml/table % minidocbook includes a subset of HTML's tables
\stopmode
\startmode[xhtml]
	\input xhtml/ent
	\input xhtml/meta
	\input xhtml/structural
	\input xhtml/primitive
	\input xhtml/block
	\input xhtml/inline
	\input xhtml/head
	\input xhtml/lists
	\input xhtml/links
	\input xhtml/table
	\input xhtml/figure
\stopmode

% output document type
\startmode[manpage]
	\environment manpage
\stopmode
\startmode[minimal]
	\environment minimal
\stopmode
\startmode[report]
	\environment report
\stopmode

% XXX: doesn't expand out \getmarking due to not being in a header
\setupinteraction[title={\getmarking[doc:title][current]}]
\setupinteraction[author={\getmarking[doc:author][current]}]
\setupinteraction[date={\getmarking[doc:date][current]}]
\setupinteraction[subtitle={\getmarking[doc:product][current]}]
\setupinteraction[keyword={\getmarking[doc:keywords]}] % note keyword= not keywords=
% TODO: doc:company
% TODO: doc:revision
% TODO: doc:product
% TODO: doc:classify
% TODO: doc:releaseinfo
% TODO: use doc:releaseinfo, doc:revision, doc:classify in subtitle perhaps
% TODO: if doc:keywords is empty, populate it from doc:product

